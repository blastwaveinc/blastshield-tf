// Code generated by generate.py from OpenAPI spec. DO NOT EDIT.

package {{ package_name }}

import (
	"fmt"
	"math/rand"
	"testing"
	"time"

	"github.com/hashicorp/terraform-plugin-testing/helper/resource"
)

func init() {
	rand.Seed(time.Now().UnixNano())
}

func randomSuffix() string {
	return fmt.Sprintf("%d", rand.Intn(100000))
}

{% for resource in resources -%}
// {{ resource.name }} Resource Tests

func TestAcc{{ resource.name }}Resource_basic(t *testing.T) {
	suffix := randomSuffix()
	resource.Test(t, resource.TestCase{
		PreCheck:                 func() { testAccPreCheck(t) },
		ProtoV6ProviderFactories: testAccProtoV6ProviderFactories,
		Steps: []resource.TestStep{
			// Create and Read testing
			{
				Config: testAcc{{ resource.name }}ResourceConfig_basic(fmt.Sprintf("test-{{ resource.tf_name }}-%s", suffix)),
				Check: resource.ComposeAggregateTestCheckFunc(
					resource.TestCheckResourceAttr("blastshield_{{ resource.tf_name }}.test", "name", fmt.Sprintf("test-{{ resource.tf_name }}-%s", suffix)),
					resource.TestCheckResourceAttrSet("blastshield_{{ resource.tf_name }}.test", "id"),
{% if resource.has_tags %}					resource.TestCheckResourceAttr("blastshield_{{ resource.tf_name }}.test", "tags.test", TestTag),
{% endif %}				),
			},
			// ImportState testing
			{
				ResourceName:      "blastshield_{{ resource.tf_name }}.test",
				ImportState:       true,
				ImportStateVerify: true,
{% if resource.name == "Node" %}				ImportStateVerifyIgnore: []string{"invitation"}, // invitation is only returned on create
{% endif %}			},
			// Update and Read testing
			{
				Config: testAcc{{ resource.name }}ResourceConfig_basic(fmt.Sprintf("test-{{ resource.tf_name }}-%s-updated", suffix)),
				Check: resource.ComposeAggregateTestCheckFunc(
					resource.TestCheckResourceAttr("blastshield_{{ resource.tf_name }}.test", "name", fmt.Sprintf("test-{{ resource.tf_name }}-%s-updated", suffix)),
{% if resource.has_tags %}					resource.TestCheckResourceAttr("blastshield_{{ resource.tf_name }}.test", "tags.test", TestTag),
{% endif %}				),
			},
			// Delete testing automatically occurs in TestCase
		},
	})
}

func testAcc{{ resource.name }}ResourceConfig_basic(name string) string {
{% if resource.name == "Node" -%}
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  node_type = "A"  # Agent
  api_access = false
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "Endpoint" -%}
	// Note: Endpoint requires a Gateway Node to exist first
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_node" "test_node" {
  name = "test-node-%[1]s"
  node_type = "G"  # Gateway (required for endpoints)
  endpoint_mode = "M"  # MAC address mode (required for gateways)
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  node_id = blastshield_node.test_node.id
  enabled = true
  endpoint = "00:11:22:33:44:55"  # MAC address (required when enabled=true)
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "Group" -%}
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  endpoints = []
  users = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "Service" -%}
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  protocols = [
    {
      ip_protocol = 6
      ports = ["80"]
    }
  ]
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "Policy" -%}
	// Note: Policy requires Groups to exist first
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_group" "test_from" {
  name = "test-from-group-%[1]s"
  endpoints = []
  users = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_group" "test_to" {
  name = "test-to-group-%[1]s"
  endpoints = []
  users = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_service" "test_service" {
  name = "test-service-%[1]s"
  protocols = [
    {
      ip_protocol = 6
      ports = ["80"]
    }
  ]
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  enabled = true
  log = false
  from_groups = [blastshield_group.test_from.id]
  to_groups = [blastshield_group.test_to.id]
  services = [blastshield_service.test_service.id]
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "EgressPolicy" -%}
	// Note: EgressPolicy requires Groups and Services to exist first
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_group" "test_group" {
  name = "test-group-%[1]s"
  endpoints = []
  users = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_service" "test_service" {
  name = "test-service-%[1]s"
  protocols = [
    {
      ip_protocol = 6
      ports = ["80"]
    }
  ]
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  enabled = true
  allow_all_dns_queries = false
  services = [blastshield_service.test_service.id]
  groups = [blastshield_group.test_group.id]
  destinations = []
  dns_names = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "Proxy" -%}
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% elif resource.name == "EventLogRule" -%}
	// Note: EventLogRule requires Groups to exist first
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_group" "test_group" {
  name = "test-group-%[1]s"
  endpoints = []
  users = []
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}

resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
  enabled = true
  conditions = []
  actions = []
  apply_to_groups = [blastshield_group.test_group.id]
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% else -%}
	// Generic config for other resource types
	return testAccProviderConfig() + fmt.Sprintf(`
resource "blastshield_{{ resource.tf_name }}" "test" {
  name = %[1]q
{% if resource.has_tags %}  tags = {
    test = %[2]q
  }
{% endif -%}
}
`, name{% if resource.has_tags %}, TestTag{% endif %})
{% endif -%}
}

{% endfor -%}
